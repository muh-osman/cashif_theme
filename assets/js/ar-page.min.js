const player=new Plyr(document.getElementById("player"));document.addEventListener("DOMContentLoaded",function(){window.addEventListener("load",function(){document.body.style.overflowY="auto";var loadingElement=document.getElementById("loading");if(loadingElement){setTimeout(function(){loadingElement.style.display="none"},5000)}});AOS.init({once:!0,})});const tooltipTriggerList=document.querySelectorAll('[data-bs-toggle="tooltip"]')
const tooltipList=[...tooltipTriggerList].map(tooltipTriggerEl=>new bootstrap.Tooltip(tooltipTriggerEl))
document.querySelectorAll(".dropdown-item").forEach((item)=>{item.addEventListener("click",function(event){event.preventDefault();document.getElementById("dropdownButton").innerText=this.innerText;document.getElementById("dropdownButton").dataset.value=this.dataset.value})});const inputElement=document.querySelector(".form-control");const buttonContainer=document.createElement("div");const resultContainer=document.getElementById("search-result");const spinner=document.getElementById("spinner");let clickedButtonId;let clickedButtonTitle;const handleButtonClick=(event)=>{buttonContainer.querySelectorAll("button").forEach((button)=>{button.classList.remove("active-model")});event.target.classList.add("active-model");clickedButtonId=event.target.id;clickedButtonTitle=event.target.getAttribute("data-model-name");if(clickedButtonId==="موديل غير موجود"){window.location.href="https://wa.me/966536181188?text=استعلام عن موديل غير موجود"}};const debounce=(func,delay)=>{let timeoutId;return(...args)=>{if(timeoutId){clearTimeout(timeoutId)}
timeoutId=setTimeout(()=>{func(...args)},delay)}};let firstTenResults;const debouncedSearch=debounce(async()=>{const searchValue=inputElement.value.trim();if(searchValue===""){resultContainer.style.gridTemplateRows="0fr"}
try{if(searchValue!==""){spinner.style.display="block";const response=await fetch("https://cashif.online/back-end/public/api/car-models/limited-general-search",{method:"POST",headers:{"Content-Type":"application/json",},body:JSON.stringify({search:searchValue}),});spinner.style.display="none";if(!response.ok){throw new Error("Failed to fetch data")}
const data=await response.json();firstTenResults=data.carModels.slice(0,10);buttonContainer.innerHTML="";if(firstTenResults.length===0){const button=document.createElement("button");button.textContent="موديل غير موجود";button.setAttribute("data-model-name","موديل غير موجود");button.id="موديل غير موجود";button.classList.add("custom-button-class","gree");button.addEventListener("click",handleButtonClick);buttonContainer.appendChild(button)}
firstTenResults.forEach((result)=>{const button=document.createElement("button");button.textContent=result.model_name;button.setAttribute("data-model-name",result.model_name);button.id=result.id;button.classList.add("custom-button-class");button.addEventListener("click",handleButtonClick);buttonContainer.appendChild(button)});resultContainer.appendChild(buttonContainer);resultContainer.style.gridTemplateRows="1fr"}else{buttonContainer.innerHTML=""}}catch(error){console.error("Error:",error);spinner.style.display="none"}},500);inputElement.addEventListener("keyup",debouncedSearch);let newData;const submit=async()=>{let yearValue=document.getElementById("dropdownButton").dataset.value;let button=document.querySelector(".submit-btn");if(!clickedButtonId){alert("يرجى اختيار موديل");return}
if(!yearValue){alert("يرجى اختيار سنة الصنع");return}
if(yearValue>=2015){yearValue=2}else{yearValue=1}
button.innerHTML=" جاري البحث...";try{const response=await fetch(`https://cashif.online/back-end/public/api/get-prices-by-model-and-year?car_model_id=${clickedButtonId}&year_id=${yearValue}`,{method:"GET",headers:{"Content-Type":"application/json",},});if(!response.ok){button.innerHTML="بحث";throw new Error("Failed to fetch data from the new API")}
newData=await response.json();button.innerHTML="بحث";const engainPrice=document.getElementById("engain-price");engainPrice.textContent=`${
      newData[0].prices[2].price * (1).toFixed(2)
    } ريال`;const mainPrice=document.getElementById("main-price");mainPrice.textContent=`${
      newData[0].prices[1].price * (1).toFixed(2)
    } ريال`;const fullPrice=document.getElementById("full-price");fullPrice.textContent=`${
      newData[0].prices[0].price * (1).toFixed(2)
    } ريال`;const overlay=document.getElementById("overlay");overlay.style.padding="16px";overlay.style.gridTemplateRows="1fr";setTimeout(()=>{overlay.scrollIntoView({behavior:"smooth",block:"start",inline:"nearest",})},100)}catch(error){console.error("Error:",error);button.innerHTML="بحث"}};const planeOneBtn=document.getElementById("plane-one");const planeTwoBtn=document.getElementById("plane-two");const planeThreeBtn=document.getElementById("plane-three");const palneA=()=>{const url=`https://wa.me/966536181188?text=طلب خدمة فحص سيارة موديل "${clickedButtonTitle}" باقة "المحركات" - ${
    newData[0].prices[2].price * (1).toFixed(2)
  } ريال`;window.location.href=url};const palneB=()=>{const url=`https://wa.me/966536181188?text=طلب خدمة فحص سيارة موديل "${clickedButtonTitle}" الباقة "الأساسية" - ${
    newData[0].prices[1].price * (1).toFixed(2)
  } ريال`;window.location.href=url};const palneC=()=>{const url=`https://wa.me/966536181188?text=طلب خدمة فحص سيارة موديل "${clickedButtonTitle}" الباقة "الشاملة" - ${
    newData[0].prices[0].price * (1).toFixed(2)
  } ريال`;window.location.href=url}